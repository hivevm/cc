plugins {
  id 'com.gradle.plugin-publish' version '1.3.0'
  id "org.hivevm.cc" version "1.0.0"
  id 'java-gradle-plugin'
  id 'maven-publish'
}


// Apply the java-library plugin to add support for Java Library
apply plugin: 'java'
apply plugin: 'java-library'
apply plugin: 'java-gradle-plugin'


repositories {
  mavenLocal()
  mavenCentral()
}


version = '1.0.0'
group	= 'org.hivevm'


java {
  sourceCompatibility = JavaVersion.VERSION_11
  targetCompatibility = JavaVersion.VERSION_11
}


allprojects {
    tasks.withType(Javadoc).all { enabled = false }
}


dependencies {
  implementation gradleApi()

  // Use JUnit test framework
  // https://mvnrepository.com/artifact/org.junit.jupiter/junit-jupiter-engine
  testImplementation 'org.junit.jupiter:junit-jupiter-engine:5.11.3'
}


sourceSets {
  main {
    java {
      srcDirs += 'src/main/gradle'
      srcDirs += 'src/main/generated'
    }
    resources {
    }
  }
/*  test {
    java {
      compileClasspath += configurations.compileOnly
      runtimeClasspath += configurations.compileOnly
    }
  }
*/}

jar {
	manifest {
		attributes 'Implementation-Title': 'HiveVM Compiler Compiler'
		attributes 'Implementation-Version': project.version
	}
	
	exclude('JavaCC.jj')
	exclude('JJTree.jjt')
}


// Configured to publish your plugin to the plugin portal
gradlePlugin {
  website = 'https://www.hivevm.org'
  vcsUrl  = 'https://github.com/hivevm/cc.git'
  plugins {
    create("gradle") {
      id = 'org.hivevm.cc'
      displayName = 'HiveVM CC'
      description = 'HiveVM parser generator for Java/C++/Rust'
      implementationClass = 'org.hivevm.cc.GradlePlugin'
      description = "Gradle plugin to use the HiveVM parser generator!"
      tags.set(["hivevm", "compiler-compiler", "parser generator"])
    }
  }
}


hiveCC {
  target       = 'java'

  step {
    name       = 'tree'
    jjtFile    = 'src/main/resources/JJTree.jjt'
    directory  = 'src/main/generated/org/hivevm/cc/jjtree'
    excludes   = [ 'BNF', 'BNFAction', 'BNFDeclaration', 'BNFNodeScope',
      'ExpansionNodeScope', 'NodeDescriptor', 'OptionBinding' ]
  }

  step {
    name       = 'parser'
    jjFile    = 'src/main/resources/JavaCC.jj'
    directory  = 'src/main/generated/org/hivevm/cc/parser'
  }

  // step {
  //   name       = 'oql4java'
  //   directory  = '/data/smartIO/develop/parser/parser/src/main/java/it/smartio/text/parser'
  //   jjtFile    = '/data/smartIO/develop/parser/parser/src/main/resources/it/smartio/text/parser/OQL.jjt'
  // }

  // step {
  //   name       = 'oql4cpp'
  //   target     = 'cpp'
  //   directory  = '/data/smartIO/develop/core-cpp/text/parser'
  //   jjtFile    = '/data/smartIO/develop/parser/parser/src/main/resources/it/smartio/text/parser/OQL-Cpp.jjt'
  // }
}